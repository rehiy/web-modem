<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modem Ë∞ÉÊµãÁ≥ªÁªü</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <h1>üì± Modem Ë∞ÉÊµãÁ≥ªÁªü</h1>
            </div>
            <div class="header-controls">
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-tab="main" onclick="app.tabManager.switchTab('main')">‰∏ªÁïåÈù¢</button>
                    <button class="nav-tab" data-tab="sms" onclick="app.tabManager.switchTab('sms')">Áü≠‰ø°Êî∂Âèë</button>
                    <button class="nav-tab" data-tab="smsdb" onclick="app.tabManager.switchTab('smsdb')">Áü≠‰ø°Â≠òÂÇ®</button>
                    <button class="nav-tab" data-tab="webhook" onclick="app.tabManager.switchTab('webhook')">Webhook</button>
                </nav>
                <div class="control-group">
                    <select class="form-select" id="modemSelect" onchange="app.modemManager.loadModemRelatedInfo()">
                        <option value="">-- ÈÄâÊã©‰∏≤Âè£ --</option>
                    </select>
                    <button class="btn btn-primary" onclick="app.modemManager.refreshModems()">Âà∑Êñ∞ËÆæÂ§á</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">

            <!-- ‰∏ªÁïåÈù¢ -->
            <div id="mainTab" class="tab-content active">

                <!-- Modem ‰ø°ÊÅØ -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Modem ‰ø°ÊÅØ</h2>
                        <div>
                            <button class="btn btn-secondary" onclick="app.modemManager.getModemInfo()">Ëé∑Âèñ‰ø°ÊÅØ</button>
                            <button class="btn btn-secondary" onclick="app.modemManager.getSignalStrength()">Âà∑Êñ∞‰ø°Âè∑</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid" id="modemInfo">
                            <div class="info-item">
                                <span class="info-label">‰∏≤Âè£</span>
                                <span class="info-value">{info.name}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Âà∂ÈÄ†ÂïÜ</span>
                                <span class="info-value">{info.manufacturer}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ÂûãÂè∑</span>
                                <span class="info-value">{info.model}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">IMEI</span>
                                <span class="info-value">{info.imei}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ÊâãÊú∫Âè∑</span>
                                <span class="info-value">{info.phone}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ËøêËê•ÂïÜ</span>
                                <span class="info-value">{info.operator}</span>
                            </div>
                        </div>
                        <div class="info-grid mt-1" id="signalInfo">
                            <div class="info-item">
                                <span class="info-label">‰ø°Âè∑Âº∫Â∫¶</span>
                                <span class="info-value">{signal.rssi}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ËØØÁ†ÅÁéá</span>
                                <span class="info-value">{signal.ber}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">‰ø°Âè∑Á≠âÁ∫ß</span>
                                <span class="info-value">{signal.level}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">dBm</span>
                                <span class="info-value">{signal.dbm}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AT ÂëΩ‰ª§ÁªàÁ´Ø -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">AT ÂëΩ‰ª§ÁªàÁ´Ø</h2>
                        <button class="btn btn-primary" onclick="app.modemManager.sendATCommand()">ÂèëÈÄÅÊåá‰ª§</button>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <input type="text" class="form-input" id="atCommand" placeholder="ËæìÂÖ• AT ÂëΩ‰ª§ (‰æãÂ¶Ç: AT+CGMI)">
                        </div>
                        <div class="terminal" id="terminal"></div>
                    </div>
                </div>

            </div>

            <!-- Áü≠‰ø°Êî∂Âèë -->
            <div id="smsTab" class="tab-content">

                <!-- Êé•Êî∂Áü≠‰ø° -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Êé•Êî∂Áü≠‰ø°</h2>
                        <button class="btn btn-secondary" onclick="app.modemManager.listSMS()">Âà∑Êñ∞ÂàóË°®</button>
                    </div>
                    <div class="card-body">
                        <div class="scroll-container" id="smsList">
                            <div class="sms-item">
                                <div class="sms-header">
                                    <span class="sms-number">üì± {sms.phoneNumber} &nbsp;</span>
                                    <span class="sms-time">üïê {sms.time} &nbsp;</span>
                                    <span class="flex-auto"></span>
                                    <button class="btn btn-small btn-danger" onclick="app.modemManager.deleteSMS({sms.indices})">Âà†Èô§</button>
                                </div>
                                <div class="sms-message">{sms.text}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂèëÈÄÅÁü≠‰ø° -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ÂèëÈÄÅÁü≠‰ø°</h2>
                        <button class="btn btn-primary" onclick="app.modemManager.sendSMS()">ÂèëÈÄÅÁü≠‰ø°</button>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Êî∂‰ª∂‰∫∫Âè∑Á†Å</label>
                            <input type="text" class="form-input" id="smsNumber" placeholder="+86XXXXXXXXXXX">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Áü≠‰ø°ÂÜÖÂÆπ</label>
                            <textarea class="form-textarea" id="smsMessage" placeholder="ËæìÂÖ•Áü≠‰ø°ÂÜÖÂÆπ..."></textarea>
                        </div>
                        <div id="smsCounter"></div>
                    </div>
                </div>

            </div>

            <!-- Áü≠‰ø°Â≠òÂÇ®ÁÆ°ÁêÜ -->
            <div id="smsdbTab" class="tab-content">

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Áü≠‰ø°Â≠òÂÇ®ÁÆ°ÁêÜ</h2>
                        <div>
                            <button class="btn btn-secondary" onclick="app.smsdbManager.listSmsdb()">Âà∑Êñ∞</button>
                            <button class="btn btn-success" onclick="app.smsdbManager.syncCurrentModemSMS()">ÂêåÊ≠•</button>
                            <button class="btn btn-danger" onclick="app.smsdbManager.deleteSelectedSmsdb()">Âà†Èô§</button>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- ËÆæÁΩÆ -->
                        <div class="filter-section">
                            <label class="form-checkbox">
                                <input type="checkbox" id="smsdbEnabled" onchange="app.settingManager.updateSmsdbSettings()">
                                <span>ÂêØÁî®Êï∞ÊçÆÂ∫ìÂ≠òÂÇ®</span>
                            </label>
                        </div>

                        <!-- ÊêúÁ¥¢ËøáÊª§ -->
                        <div class="filter-section">
                            <input type="text" class="form-input" id="smsdbFilterSendNumber" placeholder="ÂèëÈÄÅÂè∑Á†ÅËøáÊª§">
                            <select class="form-select" id="smsdbFilterDirection">
                                <option value="">ÊâÄÊúâÊñπÂêë</option>
                                <option value="in">Êé•Êî∂</option>
                                <option value="out">ÂèëÈÄÅ</option>
                            </select>
                            <input type="date" class="form-input" id="smsdbFilterStartDate" placeholder="ÂºÄÂßãÊó•Êúü">
                            <input type="date" class="form-input" id="smsdbFilterEndDate" placeholder="ÁªìÊùüÊó•Êúü">
                            <button class="btn btn-primary" onclick="app.smsdbManager.listSmsdb()">ÊêúÁ¥¢</button>
                        </div>

                        <!-- Áü≠‰ø°ÂàóË°® -->
                        <div class="scroll-container mt-1">
                            <table class="table smsdb-table" id="smsdbTable">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="smsdbCheckAll" onchange="app.smsdbManager.toggleCheckAll()"></th>
                                        <th>ID</th>
                                        <th>ÊñπÂêë</th>
                                        <th>ÂèëÈÄÅÂè∑Á†Å</th>
                                        <th>Êé•Êî∂Âè∑Á†Å</th>
                                        <th>ÂÜÖÂÆπ</th>
                                        <th>Êé•Êî∂Êó∂Èó¥</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody id="smsdbList">
                                    <!-- Áü≠‰ø°Â≠òÂÇ®ÂàóË°®È°πÊ®°Êùø -->
                                    <tr id="smsdbItem">
                                        <td><input type="checkbox" value="{id}" onchange="app.smsdbManager.toggleSmsdbSelection({id})"></td>
                                        <td>{id}</td>
                                        <td>{direction}</td>
                                        <td>{send_number}</td>
                                        <td>{receive_number}</td>
                                        <td>{content}</td>
                                        <td>{receive_time}</td>
                                        <td>
                                            <button class="btn btn-small btn-danger" onclick="app.smsdbManager.deleteSmsdb({id})">Âà†Èô§</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- ÂàÜÈ°µ -->
                        <div class="pagination">
                            <span class="pagination-info" id="smsdbPageInfo">Á¨¨ 1 È°µ</span>
                            <span class="flex-auto"></span>
                            <button class="btn btn-secondary" onclick="app.smsdbManager.smsdbPrevPage()">‰∏ä‰∏ÄÈ°µ</button>
                            <button class="btn btn-secondary" onclick="app.smsdbManager.smsdbNextPage()">‰∏ã‰∏ÄÈ°µ</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- WebhookÈÖçÁΩÆ -->
            <div id="webhookTab" class="tab-content">

                <!-- WebhookÂàóË°® -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Webhook ÈÖçÁΩÆÁÆ°ÁêÜ</h2>
                        <div>
                            <button class="btn btn-secondary" onclick="app.webhookManager.listWebhooks()">Âà∑Êñ∞ÂàóË°®</button>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- ËÆæÁΩÆ -->
                        <div class="filter-section">
                            <label class="form-checkbox">
                                <input type="checkbox" id="webhookEnabled" onchange="app.settingManager.updateWebhookSettings()">
                                <span>ÂêØÁî® Webhook ÂäüËÉΩ</span>
                            </label>
                        </div>

                        <!-- WebhookÂàóË°® -->
                        <div class="scroll-container mt-1">
                            <table class="table webhook-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>ÂêçÁß∞</th>
                                        <th>URL</th>
                                        <th>Áä∂ÊÄÅ</th>
                                        <th>ÂàõÂª∫Êó∂Èó¥</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody id="webhookList">
                                    <!-- WebhookÂàóË°®È°πÊ®°Êùø -->
                                    <tr id="webhookItem">
                                        <td>{id}</td>
                                        <td>{name}</td>
                                        <td>{url}</td>
                                        <td>{enabled}</td>
                                        <td>{created_at}</td>
                                        <td>
                                            <button class="btn btn-small btn-success" onclick="app.webhookManager.editWebhook({id})">ÁºñËæë</button>
                                            <button class="btn btn-small btn-danger" onclick="app.webhookManager.deleteWebhook({id})">Âà†Èô§</button>
                                            <button class="btn btn-small btn-secondary" onclick="app.webhookManager.testWebhook({id})">ÊµãËØï</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- WebhookÁºñËæëË°®Âçï -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" id="webhookFormTitle">ÂàõÂª∫ Webhook</h2>
                        <div>
                            <button class="btn btn-primary" onclick="app.webhookManager.saveWebhook()">‰øùÂ≠òÈÖçÁΩÆ</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">ÂêçÁß∞</label>
                            <input type="text" class="form-input" id="webhookName" placeholder="WebhookÂêçÁß∞">
                        </div>
                        <div class="form-group">
                            <label class="form-label">È¢ÑËÆæÊ®°Êùø</label>
                            <select class="form-input" id="webhookTemplateSelect" onchange="app.webhookManager.applyPresetTemplate()">
                                <option value="custom">Ëá™ÂÆö‰πâ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">URL</label>
                            <input type="text" class="form-input" id="webhookURL" placeholder="https://example.com/webhook">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ê®°Êùø (JSON)</label>
                            <textarea class="form-textarea" id="webhookTemplate" rows="10" placeholder='{"event": "sms_received", "data": {"content": "{{content}}", "send_number": "{{send_number}}"}}'></textarea>
                            <small class="text-small-secondary">ÂèØÁî®ÂèòÈáè: {{content}}, {{send_number}}, {{receive_number}}, {{receive_time}}, {{sms_ids}}, {{direction}}</small>
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="webhookEnabledCheckbox">
                                <span>ÂêØÁî®</span>
                            </label>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <!-- Êó•ÂøóÈù¢Êùø -->
    <div id="logPanel" class="logger expanded">
        <div class="logger-header">
            <span class="logger-title">üìã Á≥ªÁªüÊó•Âøó</span>
            <div class="logger-controls">
                <button class="log-btn" title="Ê∏ÖÁ©∫Êó•Âøó" onclick="app.logger.clear()">üóëÔ∏è</button>
                <button class="log-btn" title="Êî∂Áº©/Â±ïÂºÄ" onclick="app.logger.toggle()">‚¨áÔ∏è</button>
            </div>
        </div>
        <div class="logger-content">
            <div class="log-container" id="logContainer"></div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>

</html>